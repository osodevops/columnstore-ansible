{
  "variables": {
    "region": "eu-west-2",
    "version": ""
  },
  "builders": [{
    "type": "amazon-ebs",
    "iam_instance_profile": "CODEBUILD-PACKER-IAM-PROFILE",
    "profile": "default",
    "region": "eu-west-2",
    "source_ami_filter": {
      "filters": {
        "virtualization-type": "hvm",
        "name": "UBUNTU-BASE-*",
        "root-device-type": "ebs"
      },
      "owners": [
        "self"
      ],
      "most_recent": true
    },
    "vpc_id": "vpc-04332eb29585921e1",
    "subnet_id": "subnet-0fbdf398ee3dc6f0d",
    "instance_type": "t3a.large",
    "ami_name": "mariadb-cs--{{timestamp}}",
    "ssh_username": "ubuntu",
    "ami_users": [
      "334360998639"
    ],
    "tags": {
      "Name": "OSO-MaraiDB-Columnstore",
      "Commit": "{{user `COMMIT`}}"
    }
  }],
  "provisioners": [
    {
      "type": "shell",
      "script": "scripts/release_apt.sh"
    },
    {
      "type": "ansible-local",
      "playbook_file": "ansible/provision.yml",
      "role_paths": [
        "ansible/roles/mariadb"
      ],
      "extra_arguments": [ "-vvvv" ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo systemctl enable apt-daily.timer",
        "sudo systemctl enable apt-daily-upgrade.timer"
      ]
    }
  ]
}
